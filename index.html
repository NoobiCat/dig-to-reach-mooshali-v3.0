<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deep Digger</title>
<style>
body {
    margin:0;
    font-family:Arial;
    background:#111;
    color:white;
    overflow:hidden;
}
#game {
    display:flex;
    flex-direction:column;
    height:100vh;
}
#world {
    flex:1;
    position:relative;
    overflow:hidden;
}
canvas {
    position:absolute;
    width:100%;
    height:100%;
}
#ui {
    background:#1a1a1a;
    padding:8px;
}
#stats {
    font-size:14px;
}
#shop {
    max-height:180px;
    overflow-y:auto;
    margin-top:6px;
}
.shopItem {
    background:#333;
    margin:4px 0;
    padding:6px;
    border-radius:8px;
    font-size:13px;
}
button {
    border:none;
    border-radius:8px;
    padding:6px 10px;
}
.buy {
    float:right;
    background:#4CAF50;
    color:white;
}
#digBtn {
    width:100%;
    margin-top:6px;
    padding:12px;
    font-size:16px;
    background:#ff9800;
    color:white;
}
</style>
</head>
<body>

<div id="game">
    <div id="world">
        <canvas id="canvas"></canvas>
    </div>

    <div id="ui">
        <div id="stats">
            Depth: <span id="depth">0</span>m |
            Points: <span id="points">0</span>
        </div>

        <button id="digBtn">HOLD TO DIG</button>

        <div id="shop"></div>
    </div>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
resize();
window.onresize = resize;

function resize(){
    canvas.width = canvas.offsetWidth;
    canvas.height = canvas.offsetHeight;
}

let depth=0, points=0;
let digging=false;

const upgrades = {
    power:0, speed:0, auto:0, double:0,
    critChance:0, critMult:0, luck:0,
    efficiency:0, drill:0, gemValue:0,
    offline:0, depthBoost:0
};

function cost(key){
    return Math.floor(10 * Math.pow(1.8, upgrades[key]));
}

function buy(key){
    if(points>=cost(key)){
        points-=cost(key);
        upgrades[key]++;
    }
}

function dig(dt){
    let base = 1 + upgrades.power*0.5;
    let speed = 1 + upgrades.speed*0.3;
    let critChance = upgrades.critChance*0.02;
    let critMult = 2 + upgrades.critMult*0.5;

    let gain = base * speed * dt;

    if(Math.random()<critChance){
        gain *= critMult;
    }

    gain *= (1 + upgrades.double);
    gain *= (1 + upgrades.depthBoost*0.1);

    depth += gain;
    points += gain;
}

function autoDig(dt){
    if(upgrades.auto>0){
        let autoPower = upgrades.auto * 0.5 * dt;
        depth += autoPower;
        points += autoPower;
    }
}

function biomeColor(d){
    if(d<200) return "#5c3b1e";      // dirt
    if(d<600) return "#555555";      // stone
    if(d<1200) return "#333333";     // deep stone
    if(d<2000) return "#7a1f1f";     // lava
    return "#3b0066";                // crystal
}

function drawMiner(){
    let x = canvas.width/2;
    let y = canvas.height/2;

    ctx.fillStyle="white";
    ctx.fillRect(x-10,y-30,20,30); // body
    ctx.fillRect(x-5,y-45,10,15); // head

    // pickaxe animation
    let angle = digging ? Math.sin(Date.now()/100)*0.8 : 0;
    ctx.save();
    ctx.translate(x,y-20);
    ctx.rotate(angle);
    ctx.fillStyle="silver";
    ctx.fillRect(0,-2,25,4);
    ctx.restore();
}

function draw(){
    ctx.fillStyle = biomeColor(depth);
    ctx.fillRect(0,0,canvas.width,canvas.height);

    drawMiner();
}

function updateUI(){
    document.getElementById("depth").innerText=Math.floor(depth);
    document.getElementById("points").innerText=Math.floor(points);
}

function loop(t){
    if(!loop.last) loop.last=t;
    let dt=(t-loop.last)/1000;
    loop.last=t;

    if(digging) dig(dt);
    autoDig(dt);

    draw();
    updateUI();
    requestAnimationFrame(loop);
}
requestAnimationFrame(loop);

document.getElementById("digBtn").ontouchstart=()=>digging=true;
document.getElementById("digBtn").ontouchend=()=>digging=false;
document.getElementById("digBtn").onmousedown=()=>digging=true;
document.getElementById("digBtn").onmouseup=()=>digging=false;

const shopDiv = document.getElementById("shop");
for(let key in upgrades){
    let div=document.createElement("div");
    div.className="shopItem";
    div.innerHTML=key+" Lv <span id='"+key+"Lv'>0</span>" +
        "<button class='buy' onclick=\"buy('"+key+"')\">Buy</button>";
    shopDiv.appendChild(div);
}
</script>

</body>
</html>
